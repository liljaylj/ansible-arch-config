# vim: ft=yaml.ansible
---

- name: install plasma-desktop
  ansible.builtin.include_role:
    name: utils
    tasks_from: install_pkg
  vars:
    packages:
      - plasma
      - plasma-wayland-session
      - sddm
      - breeze-grub  # TODO: set grub theme
        # KDE applications
      - konsole
      - dolphin
      - kdeconnect
      - gwenview
      - okular
      - kamoso
      - partitionmanager
      - spectacle
      - ksnip
      - kdialog
      - ark
      - filelight
      - kfind
      - krename
      - kwalletmanager
      - yakuake
      - print-manager
      - kcharselect
      - kwrite
      - kate
      - kcalc
      - kdebugsettings
      - keditbookmarks
      - kgpg
      - markdownpart
      - print-manager
      - skanlite
      - skanpage
      - kdegraphics-thumbnailers
      - svgpart
      # - kio-extras
      # - kio-gdrive
      - krdc
      - kdenetwork-filesharing
      # Games
      - kmines
      - kmahjongg
      - kshisen

- name: create SDDM config dir
  become: true
  ansible.builtin.file:
    dest: '/etc/sddm.conf.d'
    state: directory
    mode: '755'

# TODO: wayland version, auto-unlock kwallet
- name: apply default SDDM config
  become: true
  ansible.builtin.template:
    src: 'plasma-desktop/00-default.conf.j2'
    dest: '/etc/sddm.conf.d/00-default.conf'
    mode: '644'

- name: rotate second monitor
  become: true
  ansible.builtin.template:
    src: 'plasma-desktop/Xsetup.j2'
    dest: '/usr/share/sddm/scripts/Xsetup'
    mode: '755'

- name: link AccountService user avatar to .face
  become: true
  ansible.builtin.file:
    src: '/var/lib/AccountsService/icons/{{ user.name }}'
    dest: '/usr/share/sddm/faces/{{ user.name }}.face.icon'
    state: link
    follow: false
    force: true

- name: enable SDDM
  become: true
  ansible.builtin.systemd:
    name: 'sddm.service'
    daemon_reload: true
    enabled: true
